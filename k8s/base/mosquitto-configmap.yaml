apiVersion: v1
kind: ConfigMap
metadata:
  name: mosquitto-config
  labels:
    app: detr-mmap
    component: mosquitto
data:
  mosquitto.conf: |
    # Mosquitto MQTT Broker Configuration
    # For detr-mmap central event collection

    # Network settings - MQTT
    listener 1883
    protocol mqtt

    # Network settings - WebSocket (for browser clients)
    listener 9001
    protocol websockets

    # Allow anonymous connections (for development)
    # TODO: not production ready
    allow_anonymous true

    # Persistence settings
    persistence true
    persistence_location /mosquitto/data/

    # Logging
    log_dest stdout
    log_type error
    log_type warning
    log_type notice
    log_type information
    log_timestamp true
    log_timestamp_format %Y-%m-%dT%H:%M:%S

    # Connection settings
    max_connections -1

    # Message settings
    message_size_limit 0

    # QoS settings
    max_queued_messages 1000

    # Performance tuning
    autosave_interval 300
    autosave_on_changes false
